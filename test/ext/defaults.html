<!DOCTYPE HTML>
<html>
<head>
    <title>ext loader test</title>

    <script>

        curl = {
            baseUrl: '..',
            extensions: { '.css': 'css' },
            paths: {
                curl: '../src/curl/',
                ext: '../src/curl/loader/ext'
            }
        };

    </script>
    <script src="../../src/curl.js" type="text/javascript"></script>

    <script type="text/javascript">

        curl(
                [
                    'stuff/one',
                    'stuff/two',
                    'ext!stuff/two',
                    'ext!stuff/base.css',
                    'ext!stuff/template.html',
                    'ext!i18n/strings.locale',
                    'domReady!'
                ]
        ).then(
                function (one, twoA, twoB, link, template, strings) {
                    write((cssLoaded() ? 'SUCCESS' : 'FAILED')
                            + ': css loaded before callback.')
                    write((1 == one ? 'SUCCESS' : 'FAILED')
                            + ': A module loaded successfully without ext.');
                    write((2 == twoA ? 'SUCCESS' : 'FAILED')
                            + ': A module with dependencies loaded successfully.');
                    write((2 == twoB ? 'SUCCESS' : 'FAILED')
                            + ': A module with dependencies loaded successfully.');
                    write((strings && strings.labels && 'beer' in strings.labels
                            ? 'SUCCESS' : 'FAILED')
                            + ': Localized strings loaded successfully');

                    write('There should be a success message below if the text file loaded:');
                    write(template);
                }
        );

        function write (msg) {
            curl(['domReady!'], function () {
                document.body.appendChild(document.createElement('div')).innerHTML = msg;
            });
        }

        function cssLoaded () {
            var el1 = document.getElementById('test1');
            var el2 = document.getElementById('test2');
            if ('currentStyle' in el1) {
                return el1.currentStyle.color == el2.currentStyle.color;
            }
            else {
                return window.getComputedStyle(el1, false).color == window.getComputedStyle(el2, false).color;
            }
        }

    </script>

</head>
<body>

<p id="test1">This text should all be the same <span id="test2" style="color: #00f;">color</span> if the css file loaded.</p>

</body>
</html>
