<!DOCTYPE HTML>
<html>
<head>
<title>createContext test</title>

<script>
	curl = {
			baseUrl: '../',
			paths: {
				curl: '../src/curl'
			}
		};

</script>
<script src="../../src/curl.js" type="text/javascript"></script>

<script type="text/javascript">

	curl(
		['curl/tdd/createContext', 'require'],
		function (createContext, require) {
			var ctx, one;

			one = 6;

			try {
				ctx = createContext();

				// mock of stuff/one
				ctx.define('stuff/one', function () { return one; });

				// uut is stuff/three
				ctx.require(['stuff/three'], function (three) {
					// stuff/three requires stuff/one and stuff/two
					// stuff/two also requires stuff/one
					// let's see if they got our mock stuff/one
					if (three == 13) {
						write('SUCCESS: mock successfully overrode actual module');
					}
					else {
						write('FAILED: mock was fetched from server');
					}

					// test splat signature
					ctx.undefine('stuff/one', 'stuff/two', 'stuff/three');

					// test again without mocks
					ctx.require(['stuff/three'], function (three) {
						// original stuff/one should be used now
						if (three == 3) {
							write('SUCCESS: module was loaded from server after undefine()');
						}
						else {
							write('FAILED: mock was still used rather than actual module after undefine()');
						}

						// test array signature
						ctx.undefine(['stuff/one', 'stuff/two', 'stuff/three']);

						// ensure all are now undefined
						try {
							require('stuff/one');
							write('FAILED: stuff/one module is still defined after undefine()')
						}
						catch (ex) {
							write('SUCCESS: stuff/one module was undefined correctly by undefine()');
						}
						try {
							require('stuff/two');
							write('FAILED: stuff/two module is still defined after undefine()')
						}
						catch (ex) {
							write('SUCCESS: stuff/two module was undefined correctly by undefine()');
						}
						try {
							require('stuff/three');
							write('FAILED: stuff/three module is still defined after undefine()')
						}
						catch (ex) {
							write('SUCCESS: stuff/three module was undefined correctly by undefine()');
						}

						// test release
						ctx.define('foo', 'foo');
						ctx.define('bar', 'bar');
						ctx.define('baz', 'baz');
						ctx.release();
						try {
							require('foo');
							write('FAILED: foo module is still defined after ctx.release()')
						}
						catch (ex) {
							write('SUCCESS: foo module was undefined correctly by ctx.release()');
						}
						try {
							require('bar');
							write('FAILED: bar module is still defined after ctx.release()')
						}
						catch (ex) {
							write('SUCCESS: bar module was undefined correctly by ctx.release()');
						}
						try {
							require('baz');
							write('FAILED: baz module is still defined after ctx.release()')
						}
						catch (ex) {
							write('SUCCESS: baz module was undefined correctly by ctx.release()');
						}

					});

				});

			}
			catch (ex) {
				write('FAILED: ' + ex.message);
			}

		},
		function (ex) {
			write('ERROR: ' + ex.message);
		}
	);

	function write (msg) {
		curl('domReady!', function () {
			document.body.appendChild(document.createElement('div')).innerHTML = msg;
		});
	}

</script>

</head>
<body>

</body>
</html>
