<!DOCTYPE HTML>
<html>
<head>
<title>cycle detection test</title>

<script>

	curl = {
		debug: true,
		paths: {
			curl: '../src/curl',
			loop: 'support/loop'
		}
	};

</script>
<script src="../src/curl.js" type="text/javascript"></script>


<script type="text/javascript">

	curl(
		[
			'loop/loop-start',
			'domReady!'
		]
	).then(
		fail,
		function (ex) {
			if (/cycle/.test(ex.message)) success(); else fail(ex);
		}
	);

	// fail if we haven't succeeded in 3 seconds. note: this is janky
	var timeout = setTimeout(fail, 3000);

	function success (foo) {
		clearTimeout(timeout);
		var doc = document;
		doc.body.appendChild(doc.createTextNode('SUCCESS: cycle detected'));
		console.log('loop detected');
	}

	function fail (ex) {
		clearTimeout(timeout);
		var doc = document;
		doc.body.appendChild(doc.createTextNode('FAILED: ' + (ex ? ex.message : 'timed out')));
		console.log('yak');
	}

</script>

</head>
<body>


</body>
</html>
